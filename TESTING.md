# OLAI.ART - Тестовые Инструкции

## Тестовый Аккаунт

| Поле | Значение |
|------|----------|
| Email | `test@olai.art` |
| Код верификации | `123456` |

Этот аккаунт автоматически проходит верификацию без отправки реального email.

---

## Окружения

| Среда | URL |
|-------|-----|
| Production | https://olai.art |
| Backend API | https://olai.onrender.com/api |
| Local Frontend | http://localhost:8080 |
| Local Backend | http://localhost:8000/api |

---

## Тестовые Сценарии

### 1. Авторизация через Header

**Цель:** Проверить логин через кнопку в хедере

**Шаги:**
1. Открыть https://olai.art
2. Нажать на иконку пользователя в правом верхнем углу
3. В выпадающем окне ввести email: `test@olai.art`
4. Нажать "Получить код"
5. Ввести код: `123456`
6. Нажать "Войти"

**Ожидаемый результат:**
- Всплывающее окно закрывается
- Иконка пользователя меняется на заполненную
- При повторном клике показывается email и кнопки "Профиль" / "Выйти"

---

### 2. Авторизация во время генерации (StepGenerating)

**Цель:** Проверить логин во время ожидания генерации

**Шаги:**
1. Открыть https://olai.art
2. Загрузить любое изображение
3. Выбрать размер (S/M/L)
4. Нажать "Создать украшение"
5. На странице генерации появится форма авторизации
6. Ввести email: `test@olai.art`
7. Нажать "Получить код"
8. Ввести код: `123456`
9. Нажать "Подтвердить"

**Ожидаемый результат:**
- Появляется галочка "Email подтверждён"
- Генерация продолжается
- После завершения генерации автоматический переход к выбору варианта

---

### 3. Полный Flow: от загрузки до оплаты

**Цель:** Проверить полный путь пользователя

**Шаги:**
1. Открыть https://olai.art
2. Загрузить изображение (рисунок/фото)
3. Опционально: добавить комментарий
4. Выбрать размер M (25мм, жетон)
5. Нажать "Создать украшение"
6. Дождаться генерации (~60 сек)
7. Выбрать один из 4 вариантов
8. Нажать "Далее"
9. На странице Checkout выбрать материал (Серебро)
10. Опционально: добавить комментарий к заказу
11. Нажать "Оплатить"
12. Завершить оплату в Tinkoff
13. После возврата - проверить страницу подтверждения

**Ожидаемый результат:**
- Все шаги проходят без ошибок
- На странице подтверждения видно: оригинал, выбранный дизайн, сумму
- Есть поле для ввода Telegram

---

### 4. Профиль пользователя

**Цель:** Проверить редактирование профиля

**Предусловия:** Пользователь авторизован

**Шаги:**
1. Нажать на иконку пользователя → "Профиль"
2. Заполнить поля:
   - Имя: `Тест`
   - Фамилия: `Тестович`
   - Telegram: `@test_user`
3. Включить/выключить подписку на рассылку
4. Нажать "Сохранить"

**Ожидаемый результат:**
- Данные сохраняются (кнопка меняется на "Сохранено")
- При перезагрузке страницы данные остаются

---

### 5. Перегенерация вариантов

**Цель:** Проверить возможность перегенерации

**Шаги:**
1. Дойти до шага выбора варианта (SELECTION)
2. Нажать "Перегенерировать"

**Ожидаемый результат:**
- Переход на шаг GENERATING
- Новая генерация запускается
- После завершения - 4 новых варианта

---

### 6. Навигация назад

**Цель:** Проверить возврат на предыдущие шаги

**Шаги:**
1. На шаге SELECTION нажать "Назад"
2. На шаге UPLOAD изменить изображение
3. Повторить генерацию

**Ожидаемый результат:**
- Переход на UPLOAD сохраняет предыдущие данные
- Новая генерация работает корректно

---

### 7. Админ-панель: Платежи

**Цель:** Проверить таб платежей в админке

**Предусловия:** Доступ к /admin (требуется админ-авторизация)

**Шаги:**
1. Открыть https://olai.art/#/admin
2. Авторизоваться (если требуется)
3. Перейти на таб "Платежи"

**Ожидаемый результат:**
- Видны карточки со статистикой (всего, успешных, сумма)
- Таблица с платежами
- Фильтр по статусу работает

---

### 8. Админ-панель: Заявки

**Цель:** Проверить просмотр и редактирование заявок

**Шаги:**
1. Открыть https://olai.art/#/admin
2. На табе "Заявки" нажать на иконку редактирования
3. В модальном окне изменить статус/форму/материал
4. Выбрать другой сгенерированный вариант
5. Нажать "Сохранить"

**Ожидаемый результат:**
- Изменения сохраняются
- Таблица обновляется

---

## Тестирование API (curl)

### Запрос кода верификации
```bash
curl -X POST https://olai.onrender.com/api/auth/request-code \
  -H "Content-Type: application/json" \
  -d '{"email": "test@olai.art", "subscribe_newsletter": true}'
```

**Ожидаемый ответ:**
```json
{
  "success": true,
  "user_id": "...",
  "message": "Verification code sent",
  "is_test": true
}
```

### Верификация кода
```bash
curl -X POST https://olai.onrender.com/api/auth/verify-code \
  -H "Content-Type: application/json" \
  -d '{"email": "test@olai.art", "code": "123456"}'
```

**Ожидаемый ответ:**
```json
{
  "success": true,
  "user_id": "...",
  "verified": true,
  "user": {
    "id": "...",
    "email": "test@olai.art",
    ...
  }
}
```

### Получение списка платежей (admin)
```bash
curl https://olai.onrender.com/api/admin/payments
```

### Обновление профиля пользователя
```bash
curl -X PATCH https://olai.onrender.com/api/users/{user_id}/profile \
  -H "Content-Type: application/json" \
  -d '{
    "first_name": "Тест",
    "last_name": "Тестович",
    "telegram_username": "@test"
  }'
```

---

## Известные Ограничения

1. **Золото недоступно** - материал "Золото 585" отключён (показывается "Скоро")
2. **Тестовые платежи** - в тестовом режиме Tinkoff можно использовать тестовые карты
3. **Генерация ~60 сек** - FAL.ai обрабатывает изображения с задержкой

---

## Чеклист Релиза

- [ ] Тестовый аккаунт работает (test@olai.art + 123456)
- [ ] Авторизация через header работает
- [ ] Авторизация во время генерации работает
- [ ] Полный flow завершается успешно
- [ ] Профиль сохраняется
- [ ] Админка показывает платежи
- [ ] Перегенерация работает
- [ ] Навигация назад работает
